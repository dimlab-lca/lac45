{% extends "base.html" %}

{% block title %}Dashboard Admin - LCA TV{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="header-content">
                <h1><i class="fas fa-tachometer-alt"></i> Dashboard Administrateur</h1>
                <div class="user-info">
                    <span>Bienvenue, {{ session.user }}</span>
                    <a href="{{ url_for('logout') }}" class="btn-logout">
                        <i class="fas fa-sign-out-alt"></i> Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="dashboard-nav">
        <div class="container">
            <nav class="nav-tabs">
                <a href="#overview" class="nav-tab active" data-tab="overview">
                    <i class="fas fa-chart-line"></i> Vue d'ensemble
                </a>
                <a href="#users" class="nav-tab" data-tab="users">
                    <i class="fas fa-users"></i> Utilisateurs
                </a>
                <a href="#publicity" class="nav-tab" data-tab="publicity">
                    <i class="fas fa-ad"></i> Publicité
                </a>
                <a href="#videos" class="nav-tab" data-tab="videos">
                    <i class="fas fa-video"></i> Vidéos
                </a>
                <a href="#articles" class="nav-tab" data-tab="articles">
                    <i class="fas fa-newspaper"></i> Articles
                </a>
                <a href="#media" class="nav-tab" data-tab="media">
                    <i class="fas fa-images"></i> Médias
                </a>
                <a href="#settings" class="nav-tab" data-tab="settings">
                    <i class="fas fa-cog"></i> Paramètres
                </a>
                <a href="#analytics" class="nav-tab" data-tab="analytics">
                    <i class="fas fa-chart-bar"></i> Analytics
                </a>
            </nav>
        </div>
    </div>

    <!-- Content Sections -->
    <div class="dashboard-content">
        <div class="container">
            
            <!-- Overview Section -->
            <div id="overview-section" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-users">{{ stats.total_users or 0 }}</h3>
                            <p>Utilisateurs</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-videos">{{ stats.total_videos or 0 }}</h3>
                            <p>Vidéos</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-ad"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-ads">{{ stats.total_ads or 0 }}</h3>
                            <p>Publicités</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-articles">{{ stats.total_articles or 0 }}</h3>
                            <p>Articles</p>
                        </div>
                    </div>
                </div>

                <div class="overview-grid">
                    <div class="overview-card">
                        <h3>Activité Récente</h3>
                        <div id="recent-activity">
                            <!-- Loaded via AJAX -->
                        </div>
                    </div>
                    <div class="overview-card">
                        <h3>Revenus Publicité</h3>
                        <div id="revenue-chart">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users-section" class="content-section">
                <div class="section-header">
                    <h2>Gestion des Utilisateurs</h2>
                    <button class="btn-primary" onclick="openUserModal()">
                        <i class="fas fa-plus"></i> Nouvel Utilisateur
                    </button>
                </div>
                
                <div class="table-container">
                    <table class="data-table" id="users-table">
                        <thead>
                            <tr>
                                <th>Nom d'utilisateur</th>
                                <th>Email</th>
                                <th>Rôle</th>
                                <th>Nom complet</th>
                                <th>Dernière connexion</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Publicity Section -->
            <div id="publicity-section" class="content-section">
                <div class="section-header">
                    <h2>Gestion Publicité</h2>
                    <div class="header-actions">
                        <button class="btn-primary" onclick="openSubscriptionModal()">
                            <i class="fas fa-plus"></i> Nouvelle Souscription
                        </button>
                        <button class="btn-secondary" onclick="openPackageModal()">
                            <i class="fas fa-package"></i> Gérer Packages
                        </button>
                    </div>
                </div>

                <div class="publicity-tabs">
                    <button class="tab-btn active" data-target="subscriptions">Souscriptions</button>
                    <button class="tab-btn" data-target="advertisements">Annonces</button>
                    <button class="tab-btn" data-target="packages">Packages</button>
                </div>

                <div id="subscriptions-tab" class="tab-content active">
                    <div class="table-container">
                        <table class="data-table" id="subscriptions-table">
                            <thead>
                                <tr>
                                    <th>Client</th>
                                    <th>Package</th>
                                    <th>Durée</th>
                                    <th>Prix</th>
                                    <th>Début</th>
                                    <th>Fin</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="advertisements-tab" class="tab-content">
                    <div class="table-container">
                        <table class="data-table" id="advertisements-table">
                            <thead>
                                <tr>
                                    <th>Titre</th>
                                    <th>Client</th>
                                    <th>Position</th>
                                    <th>Début</th>
                                    <th>Fin</th>
                                    <th>Impressions</th>
                                    <th>Clics</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="packages-tab" class="tab-content">
                    <div class="packages-grid" id="packages-grid">
                        <!-- Loaded via AJAX -->
                    </div>
                </div>
            </div>

            <!-- Videos Section -->
            <div id="videos-section" class="content-section">
                <div class="section-header">
                    <h2>Gestion des Vidéos</h2>
                    <div class="header-actions">
                        <button class="btn-primary" onclick="openVideoModal()">
                            <i class="fas fa-plus"></i> Ajouter Vidéo
                        </button>
                        <button class="btn-secondary" onclick="syncYouTubeVideos()">
                            <i class="fas fa-sync"></i> Sync YouTube
                        </button>
                    </div>
                </div>

                <div class="videos-grid" id="videos-grid">
                    <!-- Loaded via AJAX -->
                </div>
            </div>

            <!-- Articles Section -->
            <div id="articles-section" class="content-section">
                <div class="section-header">
                    <h2>Gestion des Articles</h2>
                    <button class="btn-primary" onclick="openArticleModal()">
                        <i class="fas fa-plus"></i> Nouvel Article
                    </button>
                </div>

                <div class="table-container">
                    <table class="data-table" id="articles-table">
                        <thead>
                            <tr>
                                <th>Titre</th>
                                <th>Catégorie</th>
                                <th>Auteur</th>
                                <th>Statut</th>
                                <th>Vues</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Media Section -->
            <div id="media-section" class="content-section">
                <div class="section-header">
                    <h2>Gestion des Médias</h2>
                    <div class="header-actions">
                        <button class="btn-primary" onclick="openMediaUpload()">
                            <i class="fas fa-upload"></i> Uploader Fichier
                        </button>
                        <div class="media-filters">
                            <select id="media-type-filter">
                                <option value="">Tous les types</option>
                                <option value="image">Images</option>
                                <option value="video">Vidéos</option>
                                <option value="document">Documents</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="media-grid" id="media-grid">
                    <!-- Loaded via AJAX -->
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="content-section">
                <div class="section-header">
                    <h2>Paramètres du Site</h2>
                    <button class="btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                </div>

                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>Général</h3>
                        <form id="general-settings">
                            <div class="form-group">
                                <label>Titre du site</label>
                                <input type="text" name="site_title" value="{{ settings.site_title or 'LCA TV' }}">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea name="site_description">{{ settings.site_description or '' }}</textarea>
                            </div>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>Contact</h3>
                        <form id="contact-settings">
                            <div class="form-group">
                                <label>Email de contact</label>
                                <input type="email" name="contact_email" value="{{ settings.contact_email or '' }}">
                            </div>
                            <div class="form-group">
                                <label>Téléphone</label>
                                <input type="text" name="contact_phone" value="{{ settings.contact_phone or '' }}">
                            </div>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>YouTube</h3>
                        <form id="youtube-settings">
                            <div class="form-group">
                                <label>ID Chaîne YouTube</label>
                                <input type="text" name="youtube_channel_id" value="{{ settings.youtube_channel_id or '' }}">
                            </div>
                            <div class="form-group">
                                <label>ID Vidéo Live</label>
                                <input type="text" name="youtube_live_video_id" value="{{ settings.youtube_live_video_id or '' }}">
                            </div>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3>Système</h3>
                        <form id="system-settings">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="analytics_enabled" {{ 'checked' if settings.analytics_enabled == 'true' }}>
                                    Activer les analytics
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" name="maintenance_mode" {{ 'checked' if settings.maintenance_mode == 'true' }}>
                                    Mode maintenance
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" class="content-section">
                <div class="section-header">
                    <h2>Analytics & Statistiques</h2>
                    <div class="date-range-picker">
                        <input type="date" id="start-date">
                        <input type="date" id="end-date">
                        <button class="btn-secondary" onclick="updateAnalytics()">Actualiser</button>
                    </div>
                </div>

                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Trafic du Site</h3>
                        <canvas id="traffic-chart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>Revenus Publicité</h3>
                        <canvas id="revenue-chart-detailed"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>Vidéos Populaires</h3>
                        <div id="popular-videos"></div>
                    </div>
                    <div class="analytics-card">
                        <h3>Performance Publicités</h3>
                        <div id="ads-performance"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
{% include 'modals/user_modal.html' %}
{% include 'modals/subscription_modal.html' %}
{% include 'modals/video_modal.html' %}
{% include 'modals/article_modal.html' %}
{% include 'modals/media_modal.html' %}

<style>
/* Dashboard Styles */
.admin-dashboard {
    min-height: 100vh;
    background: #f5f6fa;
}

.dashboard-header {
    background: linear-gradient(135deg, #28a745, #20693e);
    color: white;
    padding: 20px 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-content h1 {
    margin: 0;
    font-size: 1.8rem;
    font-weight: 600;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.btn-logout {
    background: rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.3s ease;
}

.btn-logout:hover {
    background: rgba(255,255,255,0.3);
}

.dashboard-nav {
    background: white;
    border-bottom: 1px solid #e9ecef;
    position: sticky;
    top: 0;
    z-index: 100;
}

.nav-tabs {
    display: flex;
    overflow-x: auto;
    padding: 0;
    margin: 0;
}

.nav-tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 15px 20px;
    color: #666;
    text-decoration: none;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.nav-tab:hover,
.nav-tab.active {
    color: #28a745;
    border-bottom-color: #28a745;
    background: #f8f9fa;
}

.dashboard-content {
    padding: 30px 0;
}

.content-section {
    display: none;
}

.content-section.active {
    display: block;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 20px;
}

.stat-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #28a745, #20693e);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
}

.stat-info h3 {
    font-size: 2rem;
    font-weight: bold;
    margin: 0;
    color: #333;
}

.stat-info p {
    margin: 5px 0 0 0;
    color: #666;
    font-size: 0.9rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 15px;
}

.section-header h2 {
    margin: 0;
    color: #333;
    font-size: 1.5rem;
}

.header-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.btn-primary, .btn-secondary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-primary {
    background: #28a745;
    color: white;
}

.btn-primary:hover {
    background: #218838;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.table-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th,
.data-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #e9ecef;
}

.data-table th {
    background: #f8f9fa;
    font-weight: 600;
    color: #333;
}

.data-table tr:hover {
    background: #f8f9fa;
}

.publicity-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 20px;
}

.tab-btn {
    padding: 10px 20px;
    border: none;
    background: #e9ecef;
    color: #666;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.tab-btn.active,
.tab-btn:hover {
    background: #28a745;
    color: white;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.overview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
}

.overview-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.overview-card h3 {
    margin: 0 0 20px 0;
    color: #333;
    font-size: 1.2rem;
}

.settings-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.settings-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.settings-card h3 {
    margin: 0 0 20px 0;
    color: #333;
    font-size: 1.2rem;
    border-bottom: 2px solid #28a745;
    padding-bottom: 10px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #333;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 0.9rem;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: #28a745;
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
}

.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
}

.analytics-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.analytics-card h3 {
    margin: 0 0 20px 0;
    color: #333;
    font-size: 1.2rem;
}

.date-range-picker {
    display: flex;
    gap: 10px;
    align-items: center;
}

.date-range-picker input {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
}

/* Responsive */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .nav-tabs {
        justify-content: flex-start;
    }
    
    .nav-tab {
        padding: 12px 15px;
        font-size: 0.9rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .overview-grid,
    .settings-grid,
    .analytics-grid {
        grid-template-columns: 1fr;
    }
}

/* Loading states */
.loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
    color: #666;
}

.loading i {
    margin-right: 10px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Status badges */
.status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-active { background: #d4edda; color: #155724; }
.status-inactive { background: #f8d7da; color: #721c24; }
.status-pending { background: #fff3cd; color: #856404; }
.status-expired { background: #f1f3f4; color: #5f6368; }

/* Action buttons */
.action-btn {
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    margin: 0 2px;
    transition: all 0.3s ease;
}

.action-btn.edit { background: #007bff; color: white; }
.action-btn.delete { background: #dc3545; color: white; }
.action-btn.view { background: #28a745; color: white; }

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
</style>

<script>
// Dashboard JavaScript functionality
document.addEventListener('DOMContentLoaded', function() {
    initializeDashboard();
});

function initializeDashboard() {
    // Initialize tab navigation
    setupTabNavigation();
    
    // Load initial data
    loadOverviewData();
    
    // Setup event listeners
    setupEventListeners();
}

function setupTabNavigation() {
    const navTabs = document.querySelectorAll('.nav-tab');
    const contentSections = document.querySelectorAll('.content-section');
    
    navTabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all tabs and sections
            navTabs.forEach(t => t.classList.remove('active'));
            contentSections.forEach(s => s.classList.remove('active'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Show corresponding section
            const targetSection = this.getAttribute('data-tab') + '-section';
            const section = document.getElementById(targetSection);
            if (section) {
                section.classList.add('active');
                
                // Load section data
                loadSectionData(this.getAttribute('data-tab'));
            }
        });
    });
}

function loadSectionData(section) {
    switch(section) {
        case 'users':
            loadUsers();
            break;
        case 'publicity':
            loadPublicityData();
            break;
        case 'videos':
            loadVideos();
            break;
        case 'articles':
            loadArticles();
            break;
        case 'media':
            loadMedia();
            break;
        case 'settings':
            loadSettings();
            break;
        case 'analytics':
            loadAnalytics();
            break;
    }
}

function loadOverviewData() {
    // Load overview statistics
    fetch('/api/admin/overview')
        .then(response => response.json())
        .then(data => {
            updateOverviewStats(data);
            loadRecentActivity();
        })
        .catch(error => console.error('Error loading overview:', error));
}

function updateOverviewStats(data) {
    document.getElementById('total-users').textContent = data.total_users || 0;
    document.getElementById('total-videos').textContent = data.total_videos || 0;
    document.getElementById('total-ads').textContent = data.total_ads || 0;
    document.getElementById('total-articles').textContent = data.total_articles || 0;
}

function loadRecentActivity() {
    fetch('/api/admin/recent-activity')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('recent-activity');
            container.innerHTML = data.map(activity => `
                <div class="activity-item">
                    <i class="fas fa-${activity.icon}"></i>
                    <span>${activity.description}</span>
                    <small>${activity.time}</small>
                </div>
            `).join('');
        })
        .catch(error => console.error('Error loading recent activity:', error));
}

function loadUsers() {
    const tbody = document.querySelector('#users-table tbody');
    tbody.innerHTML = '<tr><td colspan="7" class="loading"><i class="fas fa-spinner"></i> Chargement...</td></tr>';
    
    fetch('/api/admin/users')
        .then(response => response.json())
        .then(users => {
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td><span class="status-badge status-${user.role}">${user.role}</span></td>
                    <td>${user.full_name || '-'}</td>
                    <td>${user.last_login ? new Date(user.last_login).toLocaleDateString() : 'Jamais'}</td>
                    <td><span class="status-badge status-${user.is_active ? 'active' : 'inactive'}">${user.is_active ? 'Actif' : 'Inactif'}</span></td>
                    <td>
                        <button class="action-btn edit" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading users:', error);
            tbody.innerHTML = '<tr><td colspan="7">Erreur de chargement</td></tr>';
        });
}

function loadPublicityData() {
    // Setup publicity tabs
    const tabBtns = document.querySelectorAll('.publicity-tabs .tab-btn');
    const tabContents = document.querySelectorAll('.publicity-tabs + div .tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            this.classList.add('active');
            const target = document.getElementById(this.getAttribute('data-target') + '-tab');
            if (target) {
                target.classList.add('active');
                
                // Load specific data
                switch(this.getAttribute('data-target')) {
                    case 'subscriptions':
                        loadSubscriptions();
                        break;
                    case 'advertisements':
                        loadAdvertisements();
                        break;
                    case 'packages':
                        loadPackages();
                        break;
                }
            }
        });
    });
    
    // Load initial data
    loadSubscriptions();
}

function loadSubscriptions() {
    const tbody = document.querySelector('#subscriptions-table tbody');
    tbody.innerHTML = '<tr><td colspan="8" class="loading"><i class="fas fa-spinner"></i> Chargement...</td></tr>';
    
    fetch('/api/admin/subscriptions')
        .then(response => response.json())
        .then(subscriptions => {
            tbody.innerHTML = subscriptions.map(sub => `
                <tr>
                    <td>${sub.client_name}</td>
                    <td>${sub.package_type}</td>
                    <td>${sub.duration_months} mois</td>
                    <td>${sub.price.toLocaleString()} FCFA</td>
                    <td>${new Date(sub.start_date).toLocaleDateString()}</td>
                    <td>${new Date(sub.end_date).toLocaleDateString()}</td>
                    <td><span class="status-badge status-${sub.status}">${sub.status}</span></td>
                    <td>
                        <button class="action-btn view" onclick="viewSubscription(${sub.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" onclick="editSubscription(${sub.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading subscriptions:', error);
            tbody.innerHTML = '<tr><td colspan="8">Erreur de chargement</td></tr>';
        });
}

// Modal functions
function openUserModal(userId = null) {
    // Implementation for user modal
    console.log('Opening user modal for user:', userId);
}

function openSubscriptionModal() {
    // Implementation for subscription modal
    console.log('Opening subscription modal');
}

function openVideoModal() {
    // Implementation for video modal
    console.log('Opening video modal');
}

function openArticleModal() {
    // Implementation for article modal
    console.log('Opening article modal');
}

function openMediaUpload() {
    // Implementation for media upload
    console.log('Opening media upload');
}

// CRUD functions
function editUser(userId) {
    openUserModal(userId);
}

function deleteUser(userId) {
    if (confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?')) {
        fetch(`/api/admin/users/${userId}`, { method: 'DELETE' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadUsers();
                    showNotification('Utilisateur supprimé avec succès', 'success');
                } else {
                    showNotification('Erreur lors de la suppression', 'error');
                }
            })
            .catch(error => {
                console.error('Error deleting user:', error);
                showNotification('Erreur lors de la suppression', 'error');
            });
    }
}

function saveSettings() {
    const forms = ['general-settings', 'contact-settings', 'youtube-settings', 'system-settings'];
    const allSettings = {};
    
    forms.forEach(formId => {
        const form = document.getElementById(formId);
        const formData = new FormData(form);
        for (let [key, value] of formData.entries()) {
            allSettings[key] = value;
        }
    });
    
    fetch('/api/admin/settings', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(allSettings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('Paramètres sauvegardés avec succès', 'success');
        } else {
            showNotification('Erreur lors de la sauvegarde', 'error');
        }
    })
    .catch(error => {
        console.error('Error saving settings:', error);
        showNotification('Erreur lors de la sauvegarde', 'error');
    });
}

function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}"></i>
        <span>${message}</span>
    `;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

function setupEventListeners() {
    // Add any additional event listeners here
}
</script>
{% endblock %}