{% extends "base.html" %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr 350px; gap: 30px; margin-top: 0;">
    <div class="content-left">
        <h1 style="font-size: 32px; color: #28a745; margin-bottom: 10px; text-align: center;">LCA TV - En Direct</h1>
        <p style="color: #666; margin-bottom: 30px; text-align: center; font-size: 16px;">La chaîne au cœur de l'Afrique</p>
        
        <div class="video-player" style="background: #000; border-radius: 8px; overflow: hidden; position: relative; padding-bottom: 56.25%; height: 0; margin-bottom: 30px;">
            <div style="position: absolute; top: 10px; left: 10px; background: #e74c3c; color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold; font-size: 12px; z-index: 10;" id="live-indicator">
                EN DIRECT
            </div>
            <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 8px 12px; border-radius: 4px; font-size: 12px; z-index: 10;" id="viewer-count">
                2440 spectateurs
            </div>
            <iframe 
                id="main-video-player"
                src="https://www.youtube.com/embed/ixQEmhTbvTI?autoplay=1&mute=0&controls=1&rel=0&modestbranding=1" 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                frameborder="0" 
                allowfullscreen
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
            </iframe>
        </div>

        <div class="current-program" style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 40px;">
            <h3 style="color: #28a745; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-clock"></i>
                <span id="current-program-status">Actuellement à l'antenne</span>
            </h3>
            <div style="background: #e74c3c; color: white; padding: 8px 15px; border-radius: 4px; font-weight: bold; display: inline-block; margin-bottom: 10px;" id="current-time-slot">
                20:00 - 21:00
            </div>
            <div style="font-size: 18px; color: #333; margin: 10px 0 5px 0; font-weight: 600;" id="current-program-title">
                Journal du Soir
            </div>
            <p id="current-program-description">Toute l'actualité nationale et internationale avec nos journalistes</p>
        </div>

        <!-- Programmes Populaires Section -->
        <div style="margin-bottom: 50px;">
            <h2 style="font-size: 2rem; color: #333; text-align: center; margin-bottom: 30px; font-weight: bold;">
                Programmes Populaires
                <div style="width: 60px; height: 4px; background: #28a745; margin: 10px auto; border-radius: 2px;"></div>
            </h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 30px;">
                {% for video in featured_videos %}
                <div class="program-card" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.1); transition: transform 0.3s ease; cursor: pointer;" data-video-id="{{ video.id }}">
                    <div style="position: relative; height: 180px; background: #f0f0f0; overflow: hidden;">
                        <img src="{{ video.thumbnail }}" style="width: 100%; height: 100%; object-fit: cover;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: rgba(231, 76, 60, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    <div style="padding: 15px;">
                        <div style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 8px;">{{ video.published_at[:10] }}</div>
                        <div style="font-weight: 600; margin-bottom: 5px; color: #333;">{{ video.category|title }}</div>
                        <div style="color: #666; font-size: 14px; font-style: italic;">"{{ video.title[:30] }}..."</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Guide de Programme Section -->
        <div style="margin-bottom: 40px;">
            <h2 style="font-size: 2rem; color: #333; text-align: center; margin-bottom: 30px; font-weight: bold;">
                Aujourd'hui sur LCA TV - lundi 14 juillet 2025
                <div style="width: 60px; height: 4px; background: #4472c4; margin: 10px auto; border-radius: 2px;"></div>
            </h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-bottom: 30px;">
                <!-- Programme 1: Journal du Matin -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; align-items: flex-start;">
                        <!-- Mini Video Player -->
                        <div style="flex-shrink: 0; width: 120px; height: 68px; background: #000; border-radius: 6px; overflow: hidden; position: relative; cursor: pointer;" onclick="playInMainPlayer('ixQEmhTbvTI', 'Journal du Matin')">
                            <img src="https://i.ytimg.com/vi/ixQEmhTbvTI/mqdefault.jpg" style="width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: rgba(231, 76, 60, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">
                                <i class="fas fa-play"></i>
                            </div>
                            <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.8); color: white; padding: 1px 3px; border-radius: 2px; font-size: 8px;">
                                15:30
                            </div>
                        </div>
                        
                        <!-- Programme Info -->
                        <div style="flex: 1;">
                            <div style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; margin-bottom: 8px;">07:30</div>
                            <div style="font-weight: 600; margin-bottom: 5px; color: #333; font-size: 16px;">Journal du Matin</div>
                            <div style="color: #666; font-size: 13px; line-height: 1.4;">Réveil avec l'actualité nationale et internationale, météo et revue de presse</div>
                        </div>
                    </div>
                </div>

                <!-- Programme 2: Question de Femme -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; align-items: flex-start;">
                        <!-- Mini Video Player -->
                        <div style="flex-shrink: 0; width: 120px; height: 68px; background: #000; border-radius: 6px; overflow: hidden; position: relative; cursor: pointer;" onclick="playInMainPlayer('zjWu0nZyBCY', 'Question de Femme')">
                            <img src="https://i.ytimg.com/vi/zjWu0nZyBCY/mqdefault.jpg" style="width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: rgba(231, 76, 60, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">
                                <i class="fas fa-play"></i>
                            </div>
                            <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.8); color: white; padding: 1px 3px; border-radius: 2px; font-size: 8px;">
                                28:45
                            </div>
                        </div>
                        
                        <!-- Programme Info -->
                        <div style="flex: 1;">
                            <div style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; margin-bottom: 8px;">10:00</div>
                            <div style="font-weight: 600; margin-bottom: 5px; color: #333; font-size: 16px;">Question de Femme</div>
                            <div style="color: #666; font-size: 13px; line-height: 1.4;">L'entrepreneuriat féminin au Burkina Faso - Témoignages et conseils</div>
                        </div>
                    </div>
                </div>

                <!-- Programme 3: Journal de Midi -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; align-items: flex-start;">
                        <!-- Mini Video Player -->
                        <div style="flex-shrink: 0; width: 120px; height: 68px; background: #000; border-radius: 6px; overflow: hidden; position: relative; cursor: pointer;" onclick="playInMainPlayer('ixQEmhTbvTI', 'Journal de Midi')">
                            <img src="https://i.ytimg.com/vi/ixQEmhTbvTI/mqdefault.jpg" style="width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: rgba(231, 76, 60, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">
                                <i class="fas fa-play"></i>
                            </div>
                            <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.8); color: white; padding: 1px 3px; border-radius: 2px; font-size: 8px;">
                                20:15
                            </div>
                        </div>
                        
                        <!-- Programme Info -->
                        <div style="flex: 1;">
                            <div style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; margin-bottom: 8px;">12:00</div>
                            <div style="font-weight: 600; margin-bottom: 5px; color: #333; font-size: 16px;">Journal de Midi</div>
                            <div style="color: #666; font-size: 13px; line-height: 1.4;">Point d'actualité de la mi-journée avec nos correspondants régionaux</div>
                        </div>
                    </div>
                </div>

                <!-- Programme 4: Hits Africains -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; align-items: flex-start;">
                        <!-- Mini Video Player -->
                        <div style="flex-shrink: 0; width: 120px; height: 68px; background: #000; border-radius: 6px; overflow: hidden; position: relative; cursor: pointer;" onclick="playInMainPlayer('8aIAKRe4Spo', 'Hits Africains')">
                            <img src="https://i.ytimg.com/vi/8aIAKRe4Spo/mqdefault.jpg" style="width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: rgba(231, 76, 60, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">
                                <i class="fas fa-play"></i>
                            </div>
                            <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.8); color: white; padding: 1px 3px; border-radius: 2px; font-size: 8px;">
                                45:20
                            </div>
                        </div>
                        
                        <!-- Programme Info -->
                        <div style="flex: 1;">
                            <div style="background: #4472c4; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; margin-bottom: 8px;">13:00</div>
                            <div style="font-weight: 600; margin-bottom: 5px; color: #333; font-size: 16px;">Hits Africains</div>
                            <div style="color: #666; font-size: 13px; line-height: 1.4;">Top 10 du mois - Les meilleures musiques d'Afrique de l'Ouest</div>
                        </div>
                    </div>
                </div>

                <!-- Programme 5: Franc Parler -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; align-items: flex-start;">
                        <!-- Mini Video Player -->
                        <div style="flex-shrink: 0; width: 120px; height: 68px; background: #000; border-radius: 6px; overflow: hidden; position: relative; cursor: pointer;" onclick="playInMainPlayer('xJatmbxIaIM', 'Franc Parler')">
                            <img src="https://i.ytimg.com/vi/xJatmbxIaIM/mqdefault.jpg" style="width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: rgba(231, 76, 60, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">
                                <i class="fas fa-play"></i>
                            </div>
                            <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.8); color: white; padding: 1px 3px; border-radius: 2px; font-size: 8px;">
                                52:30
                            </div>
                        </div>
                        
                        <!-- Programme Info -->
                        <div style="flex: 1;">
                            <div style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; margin-bottom: 8px;">14:30</div>
                            <div style="font-weight: 600; margin-bottom: 5px; color: #333; font-size: 16px;">Franc Parler</div>
                            <div style="color: #666; font-size: 13px; line-height: 1.4;">La jeunesse africaine face aux défis du développement</div>
                        </div>
                    </div>
                </div>

                <!-- Programme 6: Journal du Soir -->
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; align-items: flex-start;">
                        <!-- Mini Video Player -->
                        <div style="flex-shrink: 0; width: 120px; height: 68px; background: #000; border-radius: 6px; overflow: hidden; position: relative; cursor: pointer;" onclick="playInMainPlayer('eSApphrRKWg', 'Journal du Soir')">
                            <img src="https://i.ytimg.com/vi/eSApphrRKWg/mqdefault.jpg" style="width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: rgba(231, 76, 60, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">
                                <i class="fas fa-play"></i>
                            </div>
                            <div style="position: absolute; bottom: 2px; right: 2px; background: rgba(0,0,0,0.8); color: white; padding: 1px 3px; border-radius: 2px; font-size: 8px;">
                                35:45
                            </div>
                        </div>
                        
                        <!-- Programme Info -->
                        <div style="flex: 1;">
                            <div style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 12px; display: inline-block; margin-bottom: 8px;">19:00</div>
                            <div style="font-weight: 600; margin-bottom: 5px; color: #333; font-size: 16px;">Journal du Soir</div>
                            <div style="color: #666; font-size: 13px; line-height: 1.4;">Édition principale - Toute l'actualité avec nos journalistes experts</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <!-- Replay Videos Section -->
        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h2 style="background: #e74c3c; color: white; padding: 15px 20px; margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-play-circle"></i>
                Vivez LCA en replay
            </h2>
            
            <div style="padding: 20px; max-height: 500px; overflow-y: auto;">
                <div id="replay-videos-list">
                    <!-- Videos will be loaded here -->
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <div>Chargement des vidéos...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Programs -->
        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h2 style="background: #28a745; color: white; padding: 15px 20px; margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-clock"></i>
                Prochains Programmes
            </h2>
            
            <div style="padding: 20px;">
                <div style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                    <div style="background: #4472c4; color: white; padding: 8px 15px; border-radius: 4px; font-weight: bold; font-size: 16px; margin-bottom: 10px; display: inline-block;">07:30</div>
                    <div style="font-weight: 600; margin-bottom: 5px; color: #333;">Journal du Matin</div>
                    <div style="font-size: 14px; color: #666; line-height: 1.4;">Réveil avec l'actualité, météo et revue de presse internationale</div>
                </div>

                <div style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                    <div style="background: #4472c4; color: white; padding: 8px 15px; border-radius: 4px; font-weight: bold; font-size: 16px; margin-bottom: 10px; display: inline-block;">09:00</div>
                    <div style="font-weight: 600; margin-bottom: 5px; color: #333;">Météo Africa</div>
                    <div style="font-size: 14px; color: #666; line-height: 1.4;">Prévisions météorologiques pour l'Afrique de l'Ouest</div>
                </div>

                <div style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                    <div style="background: #4472c4; color: white; padding: 8px 15px; border-radius: 4px; font-weight: bold; font-size: 16px; margin-bottom: 10px; display: inline-block;">10:00</div>
                    <div style="font-weight: 600; margin-bottom: 5px; color: #333;">Question de Femme</div>
                    <div style="font-size: 14px; color: #666; line-height: 1.4;">L'entrepreneuriat féminin au Burkina Faso</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="background: #4472c4; color: white; padding: 8px 15px; border-radius: 4px; font-weight: bold; font-size: 16px; margin-bottom: 10px; display: inline-block;">12:00</div>
                    <div style="font-weight: 600; margin-bottom: 5px; color: #333;">Journal de Midi</div>
                    <div style="font-size: 14px; color: #666; line-height: 1.4;">Point d'actualité de la mi-journée avec nos correspondants</div>
                </div>

                <button style="background: #4472c4; color: white; border: none; padding: 12px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; width: 100%; font-size: 14px;">
                    Voir la grille complète
                </button>
            </div>
        </div>

        <!-- Advertisement Space -->
        <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h2 style="background: #ffc107; color: #333; padding: 15px 20px; margin: 0; font-size: 18px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-ad"></i>
                Publicité
            </h2>
            
            <div style="padding: 20px;">
                <div id="advertisement-space" style="min-height: 200px; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #6c757d;">
                    <div style="text-align: center;">
                        <i class="fas fa-ad" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <div>Espace Publicitaire</div>
                        <div style="font-size: 12px; margin-top: 5px;">Contactez-nous pour vos annonces</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Video Player Modal -->
<div id="video-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center;">
    <div style="position: relative; width: 90%; max-width: 800px; background: #000; border-radius: 8px; overflow: hidden;">
        <button onclick="closeVideoModal()" style="position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; z-index: 1001; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-times"></i>
        </button>
        <div id="video-player-container" style="position: relative; padding-bottom: 56.25%; height: 0;">
            <!-- Video player will be inserted here -->
        </div>
    </div>
</div>

<style>
.program-card {
    transition: transform 0.3s ease;
}

.program-card:hover {
    transform: translateY(-5px);
}

.replay-video-item {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.replay-video-item:hover {
    background-color: #f8f9fa;
}

.replay-video-thumbnail {
    width: 80px;
    height: 45px;
    background: #000;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
    flex-shrink: 0;
}

.replay-video-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.replay-video-info {
    flex: 1;
    min-width: 0;
}

.replay-video-title {
    font-weight: 600;
    font-size: 13px;
    line-height: 1.3;
    margin-bottom: 5px;
    color: #333;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.replay-video-date {
    font-size: 11px;
    color: #666;
}

@media (max-width: 768px) {
    .main-content > div {
        grid-template-columns: 1fr !important;
        gap: 20px !important;
    }
    
    .program-card {
        margin-bottom: 20px;
    }
    
    .sidebar {
        order: -1;
    }
    
    #video-modal > div {
        width: 95% !important;
        margin: 20px;
    }
}
</style>

<script// YouTube API configuration
const YOUTUBE_API_KEY = 'AIzaSyC-9RCCz6mRrNWbUBhmrp37l3uXN09vXo0';
const YOUTUBE_CHANNEL_ID = 'UCkquZjmd6ubRQh2W2YpbSLQ'; // LCA TV official channel ID

// Video player management
let currentVideoId = null;
let isLiveMode = true;

// Simulate viewer count changes
function updateViewerCount() {
    const viewerCount = document.getElementById('viewer-count');
    if (viewerCount) {
        const baseCount = 2440;
        const variation = Math.floor(Math.random() * 100) - 50;
        const newCount = baseCount + variation;
        viewerCount.textContent = `${newCount} spectateurs`;
    }
}

// Update viewer count every 30 seconds
setInterval(updateViewerCount, 30000);

// Function to play video in main player
function playInMainPlayer(videoId, title) {
    const mainPlayer = document.getElementById('main-video-player');
    const liveIndicator = document.getElementById('live-indicator');
    const currentProgramStatus = document.getElementById('current-program-status');
    const currentProgramTitle = document.getElementById('current-program-title');
    const currentProgramDescription = document.getElementById('current-program-description');
    const currentTimeSlot = document.getElementById('current-time-slot');
    
    // Update main video player
    mainPlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`;
    
    // Update UI to show replay mode
    liveIndicator.textContent = 'REPLAY';
    liveIndicator.style.background = '#4472c4';
    currentProgramStatus.textContent = 'En replay';
    currentProgramTitle.textContent = title;
    currentProgramDescription.textContent = `Regardez "${title}" en replay depuis notre chaîne YouTube.`;
    currentTimeSlot.textContent = 'REPLAY';
    currentTimeSlot.style.background = '#4472c4';
    
    isLiveMode = false;
    currentVideoId = videoId;
    
    // Scroll to top to show the video
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Function to return to live mode
function returnToLive() {
    const mainPlayer = document.getElementById('main-video-player');
    const liveIndicator = document.getElementById('live-indicator');
    const currentProgramStatus = document.getElementById('current-program-status');
    const currentProgramTitle = document.getElementById('current-program-title');
    const currentProgramDescription = document.getElementById('current-program-description');
    const currentTimeSlot = document.getElementById('current-time-slot');
    
    // Return to live stream
    mainPlayer.src = 'https://www.youtube.com/embed/ixQEmhTbvTI?autoplay=1&mute=0&controls=1&rel=0&modestbranding=1';
    
    // Update UI to show live mode
    liveIndicator.textContent = 'EN DIRECT';
    liveIndicator.style.background = '#e74c3c';
    currentProgramStatus.textContent = 'Actuellement à l\'antenne';
    currentProgramTitle.textContent = 'Journal du Soir';
    currentProgramDescription.textContent = 'Toute l\'actualité nationale et internationale avec nos journalistes';
    currentTimeSlot.textContent = '20:00 - 21:00';
    currentTimeSlot.style.background = '#e74c3c';
    
    isLiveMode = true;
    currentVideoId = null;
}

// Function to play video in modal
function playVideoInModal(videoId, title) {
    currentVideoId = videoId;
    const modal = document.getElementById('video-modal');
    const container = document.getElementById('video-player-container');
    
    // Create iframe for video
    container.innerHTML = `
        <iframe 
            src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1" 
            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
            frameborder="0" 
            allowfullscreen
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
        </iframe>
    `;
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

// Function to close video modal
function closeVideoModal() {
    const modal = document.getElementById('video-modal');
    const container = document.getElementById('video-player-container');
    
    container.innerHTML = '';
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Function to get channel ID from handle
async function getChannelIdFromHandle() {
    try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=LCATV&type=channel&key=${YOUTUBE_API_KEY}&maxResults=1`);
        const data = await response.json();
        
        if (data.items && data.items.length > 0) {
            return data.items[0].snippet.channelId;
        }
        return null;
    } catch (error) {
        console.error('Error fetching channel ID:', error);
        return null;
    }
}

// Function to load replay videos
async function loadReplayVideos() {
    try {
        const channelId = await getChannelIdFromHandle();
        if (!channelId) {
            // Use fallback videos if API fails
            loadFallbackReplayVideos();
            return;
        }

        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&type=video&order=date&maxResults=15&key=${YOUTUBE_API_KEY}`);
        const data = await response.json();
        
        const container = document.getElementById('replay-videos-list');
        
        if (data.items && data.items.length > 0) {
            container.innerHTML = data.items.map(video => `
                <div class="replay-video-item" onclick="playInMainPlayer('${video.id.videoId}', '${video.snippet.title.replace(/'/g, "\\'")}')">
                    <div class="replay-video-thumbnail">
                        <img src="${video.snippet.thumbnails.medium.url}" alt="${video.snippet.title}">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 12px;">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                    <div class="replay-video-info">
                        <div class="replay-video-title">${video.snippet.title}</div>
                        <div class="replay-video-date">${new Date(video.snippet.publishedAt).toLocaleDateString('fr-FR')}</div>
                    </div>
                </div>
            `).join('');
        } else {
            loadFallbackReplayVideos();
        }
    } catch (error) {
        console.error('Error loading replay videos:', error);
        loadFallbackReplayVideos();
    }
}

// Function to load fallback replay videos
function loadFallbackReplayVideos() {
    const container = document.getElementById('replay-videos-list');
    const fallbackVideos = [
        { id: 'eSApphrRKWg', title: 'Journal LCA TV - Édition du Soir', date: '15/12/2024' },
        { id: 'xJatmbxIaIM', title: 'Franc-Parler - Débat Économie', date: '14/12/2024' },
        { id: '8aIAKRe4Spo', title: 'Festival des Masques - Culture', date: '13/12/2024' },
        { id: 'R2EocmxeJ5Q', title: 'Étalons du Burkina - Sport', date: '12/12/2024' },
        { id: 'pMlWnB5Wj3Q', title: 'Jeunesse Avenir - Entrepreneuriat', date: '11/12/2024' },
        { id: 'zjWu0nZyBCY', title: 'Question de Femme', date: '10/12/2024' },
        { id: 'ixQEmhTbvTI', title: 'Journal du Matin', date: '09/12/2024' }
    ];
    
    container.innerHTML = fallbackVideos.map(video => `
        <div class="replay-video-item" onclick="playInMainPlayer('${video.id}', '${video.title}')">
            <div class="replay-video-thumbnail">
                <img src="https://i.ytimg.com/vi/${video.id}/mqdefault.jpg" alt="${video.title}">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 12px;">
                    <i class="fas fa-play"></i>
                </div>
            </div>
            <div class="replay-video-info">
                <div class="replay-video-title">${video.title}</div>
                <div class="replay-video-date">${video.date}</div>
            </div>
        </div>
    `).join('');
}

// Function to open video in new tab (fallback)
function openVideo(videoId) {
    if (videoId && videoId !== 'undefined' && videoId !== '') {
        playVideoInModal(videoId, 'Vidéo LCA TV');
    } else {
        console.error('Invalid video ID:', videoId);
        alert('Désolé, cette vidéo n\'est pas disponible pour le moment.');
    }
}

// Add click functionality to program cards
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, setting up video functionality...');
    
    // Load replay videos
    loadReplayVideos();
    
    // Add return to live button when in replay mode
    const currentProgramDiv = document.querySelector('.current-program');
    if (currentProgramDiv) {
        const returnButton = document.createElement('button');
        returnButton.innerHTML = '<i class="fas fa-broadcast-tower"></i> Retour au direct';
        returnButton.style.cssText = 'background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-size: 12px; cursor: pointer; margin-top: 10px; display: none;';
        returnButton.id = 'return-to-live-btn';
        returnButton.onclick = returnToLive;
        currentProgramDiv.appendChild(returnButton);
    }
    
    // Setup program cards
    const programCards = document.querySelectorAll('.program-card');
    console.log('Found', programCards.length, 'program cards');
    
    programCards.forEach((card, index) => {
        const videoId = card.dataset.videoId;
        console.log(`Card ${index + 1} video ID:`, videoId);
        
        card.addEventListener('click', function() {
            openVideo(videoId);
        });
        
        // Add hover effects
        card.addEventListener('mouseenter', function() {
            const playButton = this.querySelector('.fas.fa-play').parentElement;
            if (playButton) {
                playButton.style.transform = 'translate(-50%, -50%) scale(1.1)';
                playButton.style.opacity = '1';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            const playButton = this.querySelector('.fas.fa-play').parentElement;
            if (playButton) {
                playButton.style.transform = 'translate(-50%, -50%) scale(1)';
                playButton.style.opacity = '0.9';
            }
        });
    });
    
    // Close modal on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeVideoModal();
        }
    });
    
    // Close modal on background click
    document.getElementById('video-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeVideoModal();
        }
    });
    
    // Show/hide return to live button based on mode
    function updateReturnButton() {
        const returnBtn = document.getElementById('return-to-live-btn');
        if (returnBtn) {
            returnBtn.style.display = isLiveMode ? 'none' : 'inline-block';
        }
    }
    
    // Override playInMainPlayer to show return button
    const originalPlayInMainPlayer = window.playInMainPlayer;
    window.playInMainPlayer = function(videoId, title) {
        originalPlayInMainPlayer(videoId, title);
        updateReturnButton();
    };
    
    // Override returnToLive to hide return button
    const originalReturnToLive = window.returnToLive;
    window.returnToLive = function() {
        originalReturnToLive();
        updateReturnButton();
    };
    
    // Debug: Log featured videos data
    {% if featured_videos %}
    console.log('Featured videos data:');
    {% for video in featured_videos %}
    console.log('Video {{ loop.index }}:', {
        id: '{{ video.id }}',
        title: '{{ video.title|replace("'", "\\'") }}',
        thumbnail: '{{ video.thumbnail }}'
    });
    {% endfor %}
    {% else %}
    console.log('No featured videos found');
    {% endif %}
});
</script<!-- LCA TV YouTube API Integration -->
<script src="{{ url_for('static', filename='js/lca-youtube.js') }}"></script>
{% endblock %}